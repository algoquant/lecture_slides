FRE6871 R in Finance
Harjinder Singh	harjinder.singh@nyu.edu

# previous TA
Xirui He	xh521@nyu.edu

https://teach.datacamp.com/
http://blog.datacamp.com/datacamp-student-academic-plan-9month/

# How to work with Quandl in R
https://www.datacamp.com/courses/quandl-r-tutorial
http://stackoverflow.com/questions/25340257/how-to-import-fundamentals-for-stocks-by-using-quandl-package
http://www.reddit.com/r/investing/comments/1f6kjt/anyone_know_where_i_can_find_a_data_set_of/
https://www.quantopian.com/posts/creating-an-algorithm-that-uses-fundamental-data
https://www.quantopian.com/posts/using-the-fetcher-with-quandl

# TRADINGVIEW INTEGRATES QUANDL
http://blog.tradingview.com/?p=452

# Stock market historical data
http://opendata.stackexchange.com/questions/4116/stock-market-historical-data

### start scratch

# slides on Git and GitHub

https://github.com/algoquant/HighFreq

https://github.com/algoquant/HighFreq.git


"commit" is a snapshot of your local repository,
"push" uploads your commit to the remote repository,
"branch" creates your own copy of a repository,


Ask Harjinder and Luping to follow the instructions:
How to use RStudio with GitHub

upload RMarkdownCheatSheet.pdf

these are useful links:
http://git-scm.com/docs
http://backlogtool.com/git-guide/en/
http://git-scm.com/book/en/v2
https://support.rstudio.com/hc/en-us/articles/200532077-Version-Control-with-Git-and-SVN
http://r-pkgs.had.co.nz/git.html

http://readwrite.com/2013/09/30/understanding-github-a-journey-for-beginners-part-1
http://stackoverflow.com/questions/2712421/r-and-version-control-for-the-solo-data-analyst
http://www.molecularecologist.com/2013/11/using-github-with-r-and-rstudio/


# get GitHub and Visual Git cheatsheets
http://git-scm.com/docs

# install and configure git on your computer
Windows:
http://git-scm.com/download/win
OS X:
http://git-scm.com/download/mac

four Git terms: 
repository, commit, push, and pull

# Git tutorial
http://git-scm.com/book/en/Getting-Started-First-Time-Git-Setup
http://git-scm.com/book/en/Getting-Started-Git-Basics
http://git-scm.com/book/en/Git-Basics-Tips-and-Tricks
http://www.codeproject.com/Articles/457305/Basic-Git-Command-Line-Reference-for-Windows-Users

# Create an account on GitHub
https://github.com

# GitHub tutorials
# Tip: use GitHub for Windows instead of using git command line
https://help.github.com/categories/bootcamp/
https://help.github.com/articles/good-resources-for-learning-git-and-github/

submit homeworks as gists? - no

# GitHub Video Guides
http://www.youtube.com/GitHubGuides
# fork, pull, & merge
https://help.github.com/articles/be-social
https://help.github.com/articles/using-pull-requests


# Download GitHub for Windows
https://windows.github.com/


# configure RStudio version control
Tools
Global Options
Enable version control
Git executable
C:/Program Files (x86)/Git/bin/git.exe

# create RSA key in RStudio
view public key
copy public key

verify that RSA key file exists:
file.exists("~/../.ssh/id_rsa.pub")


# Provide GitHub the public key
https://github.com/settings/ssh
click
"Add SSH key"


### end scratch


# topics to include
matrix multiplication using
%%, %*%, %/%, %in%, %o%, %x%
operators


###

# topics to include in FRE6871_Lecture_5:

# datacamp Data Analysis and Statistical Inference
https://www.datacamp.com/courses/data-analysis-and-statistical-inference-mine-cetinkaya-rundel

# datacamp Data Analysis and Statistical Inference
https://www.datacamp.com/courses/data-analysis-and-statistical-inference-mine-cetinkaya-rundel

# datacamp Quandl in R
https://www.datacamp.com/courses/how-to-work-with-quandl-in-r

# datacamp Zivot Computational Finance and Financial Econometrics
https://www.datacamp.com/courses/introduction-to-computational-finance-and-financial-econometrics


# RStudio Setup Guide.pdf

# Leisch lm example
Leisch Creating Packages.pdf

Where does R store packages?
C:\Program Files\R\R-3.1.1\library
C:\Users\Jerzy\Documents\R\win-library\3.1

http://stat.ethz.ch/R-manual/R-devel/library/base/html/libPaths.html
normalizePath(.Library)
.libPaths()
http://stackoverflow.com/questions/2615128/where-does-r-store-packages
the default path is the first of these.
You can override that via an argument to both install.packages() (from inside R) or R CMD INSTALL (outside R).

# optimising, profiling and accelerating code
http://adv-r.had.co.nz/Profiling.html#be-lazy
rowSums(), colSums(), rowMeans(), and colMeans() are faster than equivalent invocations that use apply() because they are vectorised (the topic of the next section).
vapply() is faster than sapply() because it pre-specifies the output type.
If you want to see if a vector contains a single value, any(x == 10) is much faster than 10 %in% x. This is because testing equality is simpler than testing inclusion in a set.
apply() always turns its input into a matrix. Not only is this error prone (because a data frame is more general than a matrix), it is also slower.
you can make a function faster by avoiding method dispatch
For S3, you can do this by calling generic.class() instead of generic()
calling mean.default() quite a bit faster than calling mean() for small vectors

# package: rportfolios

# package: PerformanceAnalytics
Return.portfolio with rebalance_on
http://quantstrattrader.wordpress.com/2014/12/12/the-zomma-warthog-index/

# create a function that takes a char string "sym_bol"
read file named "my_var.RData" that contains a single variable called "my_var"
call the function with an argument "my_var" 
plot "my_var"
assign a char string "my_var" to a variable called "sym_bol"

# Speeding Up R Code - Compiling Functions - microbenchmark()
http://www.noamross.net/blog/2013/4/25/faster-talk.html

# Monte Carlo Simulation
Matloff book The Art of R Programming
vectorize the simulation

# Functional Programming and Memory Issues
Matloff book The Art of R Programming

# Avoiding Memory Copy
Matloff book The Art of R Programming

# Using Rprof() to Find Slow Spots in Your Code
Matloff book The Art of R Programming

# Writing C/C++ Functions to Be Called from R
Matloff book The Art of R Programming

# parallel R
Matloff book The Art of R Programming

# K-Means Clustering
Matloff book The Art of R Programming


### Cosma Shalizi - very good!

# Shalizi Advanced Data Analysis
C:\Research\R\Tutorials\Shalizi Advanced Data Analysis
# Shalizi Statistical Computing
C:\Research\R\Tutorials\Shalizi Statistical Computing
lecture-09.pdf


###

# data sources of historic corporate financials (balance sheets, income statements, etc)
http://www.reddit.com/r/investing/comments/2n43qg/sources_of_historic_corporate_financials_balance/

# Beneish M Score
http://ycharts.com/glossary/terms/beneish_m_score

# queries:
quantmod Yahoo data frame financial company earnings
r historical corporate balance statement
CapitalIQ
http://www.quanthouse.com/
https://www.capitaliq.com/home/what-we-offer/how-you-can-get-it/advisory-service/consortia-and-data-analytics.aspx
http://www.reddit.com/r/investing/comments/2n43qg/sources_of_historic_corporate_financials_balance/
http://stackoverflow.com/questions/3693189/programmatic-api-for-downloading-historical-financial-statements
http://allthingsr.blogspot.com/2012/10/pull-yahoo-finance-key-statistics.html
http://stackoverflow.com/questions/2614767/using-r-to-analyze-balance-sheets-and-income-statements
http://cran.r-project.org/web/packages/XBRL/index.html


###

Anscombe's quartet in ggplot2

###

introduce ts: xts, xtsExtra
lag xts

discuss efficient recursive rbind function for HFREQ data

# remove rows with duplicate timestamps
http://stackoverflow.com/questions/8865257/r-language-remove-duplicate-rows-from-xts-object
my_xts <- my_xts[!duplicated(index(mt.xts)), ]

# flatten list by row into one xts
big_xts <- do.call(rbind, list_xts)

# flatten list by column into one xts
big_xts <- do.call(cbind, list_xts)

# do.call() examples

# convert list of matrices to one big matrix
matrix.data <- do.call(rbind, list.data)

# Create ladder of trigger levels
triggers <- do.call(rbind, lapply(-30:30, function(x) rbind(c(0.1*x, -1, -1), c(-0.1*x, 1, 1))))

blah <- do.call(cbind, mtcars)

# flatten cbind list into one multidim .xts
sn.xts.data <- do.call('cbind', sn.data)

trading.rules <- list(rules.func="fillOrders.alphaModel", rules.params=triggers)

###

notepad ++


###

# rdocumentation search tool by Jonathan Cornelissen
http://www.rdocumentation.org/


###

# find the last day of the month
http://tradeblotter.wordpress.com/2014/10/17/find-the-last-day-of-the-month/


###

# update mtcars regression example
http://zoonek2.free.fr/UNIX/48_R/09.html#7
https://rpubs.com/kavipubs/25400
http://rstudio-pubs-static.s3.amazonaws.com/20858_82b28110c8ec44129848a691c4f02246.html

###

functions:	assign, get, as.name, 


###

mtcars regress:
create formula using colnames and paste

create variable out of column name


### Regression of time series data ARIMA

Lundholm Introduction R Time Series
Regression and time series data
auto.arima() handles order selection and differencing 
(but only checks that errors are stationary).
Model Variable selection
AIC, AICc, BIC


###

# Kelly criterion
PerformanceAnalytics
KellyRatio.R


Kelly:
create charts of random time series of wealth with different expected pv and growth rates
create charts of random time series of ruin
create terminal wealth charts
as function of betting fraction
as function of probability
as function of odds


Kelly in R:
simulate binary betting strategy using "for" loops and/or "apply"
then also simulate using vector functions
which betting fraction maximizes expected terminal wealth? - step-wise
which betting fraction maximizes expected growth rate? - Kelly
calculate SR of binary betting strategy
which betting fraction maximizes SR?

Kelly in R:
calculate utility as function of betting fraction, from empirical time series of returns, 
compare with Kelly from variance alone
include skew and kurtosis


Kelly for negative betting fraction (shorting)
Kelly for betting fraction greater than 1 (leverage)

create test or homework

Kelly proofs:
find optimal betting fraction, assuming you know the future number of wins and losses
find max expected log of wins and losses
extend Kelly formula to higher moments


# Shlok Datye: Kelly Criterion and Optimal-f
http://shlok.is/thesis
Shlok Kelly Optimal-f Criteria.pdf
# Kelly Criterion and Optimal-f
https://alphaism.wordpress.com/2012/04/13/testing-kelly-criterion-and-optimal-f-in-r/
Vince Kelly Optimal-f Criteria.pdf

###

using the empirical time series of returns,
calculate the term structure of: mean return, variance, skewness and kurtosis
show that mean grows like t, 
variance grows like sqrt(t), 
skewness decays like 1/sqrt(t), 
kurtosis decays like 1/t, 



###

# explain in detail this good example how to create matrix
mat_var <- matrix(sample(1:12), ncol=3, 
                  dimnames=list(
                  row_names=sapply(1:4, function(num) paste0("row", num)),
                  col_names=sapply(1:3, function(num) paste0("col", num)))
                  )


###

load data from YAHOO
zoo it
plot it
hist returns
pacf returns
reg against S&P


###



####################################

###


###

# email

Dear Students,
I'm scheduling a make-up class because there are four lectures left in this course, but only three weeks left in the Semester.
I plan to deliver lectures on the following dates:  Nov. 21st, Nov. 24th, Dec. 1st, and Dec. 8th.
There will be a lecture on Monday Nov. 24th, as usual.


Dear Students,
I would like to schedule a make-up class this Friday, Nov 21st from 6PM to 9PM.  Please let me know if this is inconvenient for you.


Dear Students,
The Teaching Assistant is Xirui (Sherry) He (xh521@nyu.edu).
Please email all homeworks and tests to Sherry He.


Dear Students,
Starting next week I will be teaching FRE7241 Algorithmic Portfolio Management.  
This course will apply the R language to portfolio management, and will be a great opportunity to apply what you've learned in the R course.  
Some of the topics covered will be:

The first lecture will be on Tuesday Nov 4th.

Regards,  Jerzy Pawlowski
NYU Polytechnic, Finance and Risk Engineering

# email

Dear Students,
According to Albert, the dates for FRE-GY 7241 I2 Algorithmic Portfolio Management, are from Oct. 29 to Dec. 19, 2014.
So there will be no class on Oct. 28.  The first class will be on Tuesday Nov 4th.
It would be much better if you could attend.  I will be presenting a lot of new material in the R language.

Are you proficient with the R language?

Regards,  Jerzy Pawlowski
NYU Polytechnic, Finance and Risk Engineering


# email for test:

Dear Students,
Please install packages: moments, ggplot2, gridExtra, wordcloud

Dear Students,
On Monday Nov. 24th there will be an in-class test.  
The test will start at 6:30 PM, and will last 40min until 7:10 PM.
The lecture will start at 6:00 PM, as usual.  
I will email the test instructions at 6:30 PM, and you will be required to email you file by 7:10 PM.

The test will be based on lecture notes, so please study the topics below.

functions for manipulating strings, such as "paste", "substring", and "strsplit",
how to coerce strings and numeric variables to date-time objects,
functions from package lubridate, 
how to write your own functions,
control statements "if" and "else",


Dear Students,
Attached to this email is an *.R file with instructions for today's test.
Please download this file, and rename it to "your_name_test1.R"
Then open it and write in this file the R code needed to perform the required tasks, 
Once you finished, then send this file to Xirui He (xh521@nyu.edu)

You are free to read and copy code from all the lecture notes, the internet, or any other sources, except you're not allowed to consult with or to copy from each other.
Hint: the lecture notes contain most of the code needed to finish the test.

Please email your R code and the file called "zoo_series.txt" to the TA no later than 7:10 PM, Imane Sanhaji (imane.sanhaji@nyu.edu).


Regards,  Jerzy Pawlowski
NYU Polytechnic, Finance and Risk Engineering

Dear Students,
This Friday there will be an in-class test.  Please make sure to bring your laptops and log into WiFi.  I will email the test at 6:30PM via NYU Classes.
The test will start at 6:30 PM, and will last 20min until 6:50 PM.

Study how to merge zoo objects.
Study how to rename column names in zoo objects.
Study how to scrub bad data using the function na.locf().
Study data aggregation using the functions rollapply(), rollmean(), and rollmedian().
Study the options of the aggregation functions, especially the "align" option.  Which value of "align" corresponds to aggregating values from the past?
Study how to write and read from comma-delimited CSV files using the functions read.zoo() and write.zoo().
Study how to plot two lines on the same plot.
Study how to plot with two "y" axes.
Study how to divert graphics output to graphics files.

The lecture will start at 6:00 PM, as usual.  

The test will use the results of the first test, so please study the solution code from the first test.

Dear Students,
Today there will be an in-class test.  
Please make sure to bring your laptops and log into WiFi.
I will email the test at 6:30PM via NYU Classes.
You will be required to produce R code and email it to the TA, Imane Sanhaji (imane.sanhaji@nyu.edu).
To get full credit, your R code must be complete and run in an R session as you submitted it.
You will have access to all notes, internet, and any other sources, except you're not allowed to consult with or to copy from each other.

Please review the following topics:
converting character strings into date-time objects,
creating time index,
creating zoo objects,
subseting time series objects,
plotting zoo objects.

Please review the following functions:
paste(), substring(), as.POSIXct(), as.Date(), index(), window(), plot(), colnames().

Regards,  Jerzy Pawlowski
NYU Polytechnic, Finance and Risk Engineering

Dear Students,
Below are the instructions for today's test.
You are free to read and copy code from all the lecture notes, the internet, or any other sources, except you're not allowed to consult with or to copy from each other.

Please email your R code and the file called "zoo_series.txt" to the TA no later than 6:50 PM, Imane Sanhaji (imane.sanhaji@nyu.edu).

Instructions:
load package Ecdat, to be able to access Garch data,
the field Garch$date contains dates as strings in the format "yymmdd",
from field Garch$date create a vector of strings in the format "yyyy-mm-dd", using nested calls to paste() and substring(),
create a date-time index called "zoo_index", by coercing the vector of strings into a vector of POSIXct dates using as.POSIXct(),
create a zoo object called "zoo_series" from field Garch$dm and from zoo_index, using zoo(),
count the number of NA values in "zoo_series" using is.na(),
remove any NAs using na.omit(),
save "zoo_series" to text file called "zoo_series.txt", using write.zoo(),
subset the "zoo_series" object to the dates from "1982-01-01" to "1986-01-01", using either logical operators or window(),
plot "zoo_series" and add a title containing the word "rate" and the name of field Garch$dm, using paste() and colnames(),

Dear Students,
The lecture today will start at 6:00 PM, as usual.  The test will start at 6:30 PM, and will last 20min until 6:50 PM.

Regards,  Jerzy Pawlowski
NYU Polytechnic, Finance and Risk Engineering


### grading and partial credit policies

Please grade the homeworks and input the scores into the attached spreadsheet.  
Attached are solutions to homeworks #1 and #2.  
I've included the maximum score for each part of the homeworks and tests, in the solutions files that I prepared.
I'll send the remaining homework solutions and test solutions tomorrow.

The solution files contain the maximum scores for each part of the homeworks and tests.
Please give partial credit as follows: 
zero score for code that's completely incorrect,
about 1/3 max score for some correct code, but with several major errors,
about 2/3 max score for code that is almost correct, but has no more than one major error,
max score for code that is correct, without any major errors, but that may have minor errors,

a major error is missing code, or code that doesn't produce the right answer,
a minor error is code that produces a slightly different answer, but is in the spirit of what was expected,

I suggest running the students' code to see what it produces, in addition to reading it.
Please the homeworks and input the scores into the spreadsheet that I sent in a previous email.  


Regards,  Jerzy Pawlowski
NYU Polytechnic, Finance and Risk Engineering


### ideas for homework:

create a function that calculates moments
takes returns, moment order, logical to normalize de-mean
uses if statements

### ideas for homework:

create a function that downloads and saves data for a list of symbols
use functions:	Filter, assign, get, as.name, 

# this example uses quantmod
http://stackoverflow.com/questions/11179154/r-names-of-quantmod-variables
library(quantmod)
# create new environment
myEnv <- new.env()
# pull all data and load into myEnv
getSymbols("TLT;LQD;HYG;SPY;DBC", env=myEnv)
# eapply calls Ad on each symbol in myEnv and returns a list
# do.call calls merge with each element returned from eapply as an argument
MainXTS <- do.call(merge, c(eapply(myEnv, Ad),all=FALSE))

### ideas for homework:

perform double barrier simulation using \texttt{vectorized} functions
instead of \texttt{while} loop 
optimization in \texttt{R}

    \item 
to stop the simulation if the prices first cross barrier.level1=-10, and then cross barrier.level2=10,
Create an $R$ script for simulating 1000 random prices using rnorm(),
Use \texttt{vector} instead of \texttt{while} loop 
to stop the simulation if the prices first cross barrier.level1=-10, and then cross barrier.level2=10,
Plot the prices and the two barrier levels,


### ideas for homework:


### ideas for test:

do.call(rbind, ...)


### ideas for test:


### ideas for test:

create a csv file with numeric data plus some bad text data 
read csv file and coerce to numeric
find bad data and scrub it


### ideas for test:

create a csv file with time series data plus some bad text data 
read csv file and coerce to numeric
format the dates and times
find bad data and scrub it
create zoo and plot it


### ideas for test:

modify get.hist.quote to download from any URL
add extra argument for URL, with default:
http://ichart.yahoo.com/table.csv


### ideas for test:

create a function with a bug and ask to fix the bug


### ideas for test:

Sorting Data Frames
df.florist[order(df.florist$v.color), ]

subsetting matrices

dereferencing lists of vectors using '[[' and '$' combined with '['

filtering data
dereferencing and counting data
v.na[!is.na(v.na)]
sum(!is.na(v.na))

modify Recursive Function


### ideas for test:

## create vector of four names using paste()
vec_names <- paste0("var", 1:4)
# create a named vector of four random values using rnorm()
vec_rand <- rnorm(4)
# assign names to vector from vec_names (?)
names(vec_rand) <- vec_names
# create four variables from the vector of four names and assign them to the vector of four random values
# use a for() loop and assign()
for (var_name in vec_names) {
  # assign column values to column names
  assign(var_name, vec_rand[var_name])
}  # end for
# or
for (in_dex in 1:4) {
  # assign column values to column names
  assign(vec_names[in_dex], vec_rand[in_dex])
}  # end for



### ideas for test:

# data pivoting

# split frame by hand:
# split mtcars into list based on number of cylinders
six_cyl   <- mtcars[mtcars$cyl==6, ]


### ideas for test:

create toy script:
convert EuStockMarkets to zoo
introduce NAs
save it to file
read data from file in lapply loop
file has bad data and loop bombs
assignment:
fix loop using tryCatch

lapply loop returns list
flatten list to zoo


### ideas for test:

write a function called read.matrix

a wrapper function for read.csv(), 
so that numeric matrices are coerced back to numeric and rownames are restored
called read.num.matrix()

add data error to matrix
save matrix
read it back using read.num.matrix()
coerce column back to numeric 
restore matrix value using mean

save ts to csv file
read it back
remove NA and NaN

df.florist[order(df.florist$v.color), ]

na.locf()
scrubbing data


###

# syntax examples

# set operators
%in% binary operator
"xtable" %in% rownames(installed.packages())


###


### unfinished slides:

Warning and Error Messages in Functions

Exploring Generic Functions - UseMethod()

Infix Functions

Simple Regression Example

Plotting a Regression

Anonymous Functions

lapply Examples

The split-apply-combine Procedure

The split-apply-combine Procedure ramnathv

Compare for() Loops With split-apply-combine Procedure

Examples of split-apply-combine Procedure



### modify and rework slides:

Reading and Writing Data Frames



### expand slides:

add extra slides on tryCatch
add slide with very simple example
divide existing tryCatch slide into two
do handlers need "return" statement?
how does "return" statement in handlers affect output?


### improve slides:

plot scatterplot - move to plotting ?

scatter plot (regression)

formula plot
plot(Ozone ~ Wind, data=airquality, pch=as.character(Month))

plot with two y axis

plot in multiple panes

plot multiple ts in multiple panes

adding points() to line plot

points(x=rep(100,10), y=seq(0,90,10), pch=seq(1,20,2))

add slide for plotting two ts zoo.msfteur in two panes

points, 
lines, 
abline, 
axis, 
title, 
legend,
text,


## add slides:

# explain use for t-statistic, and where it's coming from


# beta shrinkage estimator
http://eranraviv.com/blog/a-shrinkage-estimator-for-beta/


# beta bootstrap
http://eranraviv.com/bootstrap-example/


# regression spurious
http://eranraviv.com/spurious-regression-illustrated/


# Martin A. Lindquist - very good Regression Analysis lectures with R code
http://www.stat.columbia.edu/~martin/
Lindquist Model Diagnostics for Regression.pdf


# option implied volatility using Bisection Method - very simple illustrative code
http://gfoix.com/volatility-smiles-using-r-an-example-with-ubs-equity-options/
http://gfoix.com/wp-content/uploads/2013/11/20131119_ImplicitVolatility_R.R
http://gfoix.com/wp-content/uploads/2013/11/20131119-UBS_OptionData_18Nov.txt
C:/Develop/R/scripts/option_vol.R
C:/Develop/R/scripts/option_vol.txt


# vectorization
# create examples showing dumb loops versus smart code using vectorized R functions
# create examples showing loops are needed for path dependent problems
http://blog.revolutionanalytics.com/2014/04/a-look-a-r-vectorization-through-the-collatz-conjecture.html
http://cartesianfaith.com/2014/01/06/how-to-use-vectorization-to-streamline-simulations/
http://www.noamross.net/blog/2014/4/16/vectorization-in-r--why.html
Teetor Fast(er) R Code.pdf


# script for reading panel data from *.csv file and creating xts object
# panel data consists of prices by ticker symbol and dates
C:/Develop/R/scripts/funcDevelop.R

# data pivoting
Cross Tabulation with table and xtabs

## error handler functions that return a function
an application of functions that return a function
example showing the difference between returning a value and returning a function
only functional can return a function
use MySqrt function that throws error if arg is negative
C:/Develop/R/scripts/funcDevelop.R


## multiple slides about doing things the R way:
allocating instead of growing
apply vs for
vectorized funtions vs apply
# emphasise syntax and speed


## return parsed but unevaluated expressions in a list
parse()
# convert expressions into character strings - inverse of parse()
deparse()
# convert arguments into a vector of strings
deparse(substitute(var))
deparse(substitute(x)) returns [1] "x"
# the use of 'deparse(substitute())' is strongly discouraged
http://stackoverflow.com/questions/5542945/opposite-of-rs-deparsesubstitutevar
as.expression("x") works to get the variable from the variable name

# reverse is:
eval(parse(text=...))
or
eval(substitute(...))


# Fix an Object
fix()

## String Formatting Command
sprintf("%5.4f", pi)


## function debugging
debug()
browser()
stopifnot()
return()

# formatting colnames with paste
paste0()

# introduce and review
Package tseries
Class timeSeries
Rmetrics suite


### introduce ts Time Series Objects

# Reading and Writing zoo Time Series to csv files

# subsetting zoo object

# ts aggregation
calculate weekly, monthly returns

discuss yearfrac index
index is a number:	2014.2123
convert to date
as.Date(365*(index(zoo.dax)-1970))

# calculate trailing average

# Portfolio Efficient Frontier

# count number of rows or columns

# Create slide summarizing Time series: Implementations:
"ts" (base): regular "numeric" time index (e.g., annual, quarterly, monthly),
"its" (its): irregular time index of class "POSIXct",
"irts" (tseries): irregular time index of class "POSIXct",
"timeSeries" (timeSeries): irregular time index of class "timeDate",
"zoo" (zoo): regular or irregular time index of arbitrary class.
"xts" (xts): built on top of "zoo", with specialized infrastructure for
time indexes of class "Date", "POSIXct", "chron", "timeDate",
"yearmon", "yearqtr", . . .


# Boxplot Example

# create overview of functions:
is.*
as.*

# AER package includes replication datasets for econometrics

# ReturnAnalytics
For example packages which are part of the \texttt{ReturnAnalytics} project,\\
\hskip1em\url{https://r-forge.r-project.org/projects/returnanalytics/}\\
\hskip1em\url{https://r-forge.r-project.org/R/?group_id=579}\\


# list.files()
List the Files in a Directory/Folder
dir(pattern="csv")


with plotmath mathematical annotations

with par()
describing plot() params par()

list of Graphical Parameters
https://stat.ethz.ch/R-manual/R-devel/library/graphics/html/par.html


# how to create empty plot
plot(x=1:10, y=1:10, xlab="", ylab="", type="n")
add text with annotation
text(5.0, 5.0, expression(beta==11))
text(6.5, 0.28, expression(paste(beta==5)))



pca and barplot


###

http://cran.r-project.org/bin/windows/Rtools/


###

sort()
order()

# operators

# simple pipe operator
http://active-analytics.com/blog/magrittr-in-one-line/

http://stackoverflow.com/questions/1295955/what-is-the-most-useful-r-trick

which()
match()

subset()

dput()


###

https://www.linkedin.com/groups/R-Project-Statistical-Computing-77616

$R$
\texttt{R}

$Q-Q$
\texttt{$Q-Q$}

FALSE
\texttt{FALSE}

TRUE
\texttt{TRUE}

$RStudio$
\texttt{RStudio}

$CRAN$
\texttt{CRAN}

$Excel$
\texttt{Excel}

p-value


$Shapiro-Wilk$




###

R --vanilla <xyz.rxyz.out

explain function:	data()

data(airquality, package="datasets")
class(airquality)
air_ozone <- airquality$Ozone
med_ozone <- median(air_ozone, na.rm=TRUE)
low_ozone <- (air_ozone < med_ozone)
mean(low_ozone, na.rm=TRUE)

http://adv-r.had.co.nz/Computing-on-the-language.html

http://faculty.nps.edu/sebuttre/home/RIndex.html

http://en.wikibooks.org/wiki/Data_Mining_Algorithms_In_R


###

add:

setting up RStudio projects

Installing Packages from GitHub

:: function
zoo::rollmedian
::: function
zoo:::rollmedian


script files
source() scripts

Startup

Sys.getenv()
R.home()

Sys.setenv(TZ="GMT")
Sys.getenv("TZ")


setting R options
r environment variables

.packages(all=TRUE)  # display installed packages

installed.packages()  # get info on all packages (produces a lot of stuff)

# another way to display installed packages
packinfo <- installed.packages(fields=c("Package", "Version"))
packinfo[,c("Package", "Version")]
packinfo["xts",c("Package", "Version")]

objects()  # display currently loaded objects

search()  # display loaded packages


plotting

no type declaration of variables in R

logical

factor analysis

keywords

vectors

load
invisible

error messages

NA/NaN argument

create library and document with Roxygen

debug

Pry open the covers of R
library(pryr)
https://github.com/hadley/pryr

codetools

http://adv-r.had.co.nz/Expressions.html

Regular expressions in R vs RStudio
http://robinlovelace.net//r/2014/04/14/regex-in-R-RStudio.html



###

read
Wickham Split Apply Combine for Data Analysis

meet with C++ guy to coordinate RCPP

use combination of take-home homeworks and also online tests in class
online tests in class should be say 20min and should test basic syntax skills
create website with online tests
Google create online interactive software tests
http://worldclass.io/
http://www.classmarker.com/
http://www.proprofs.com/quiz-school/

# R exams package
http://www.r-statistics.com/2012/12/generation-of-e-learning-exams-in-r-for-moodle-olat-etc/
http://cran.r-project.org/web/views/ReproducibleResearch.html

# Free Tools for Teachers
http://elearningindustry.com/321-free-tools-for-teachers-free-educational-technology


### caret package for creating predictive models: give examples
http://caret.r-forge.r-project.org/
# confusion matrix
# classification test Sensitivity and specificity
http://en.wikipedia.org/wiki/Sensitivity_and_specificity
http://en.wikipedia.org/wiki/Receiver_operating_characteristic



### incorporate:


RQuantLib examples from
RQuantLib Integration.pdf


# Data Science with R
C:\Research\R\Tutorials\OnePageR Data Science
http://onepager.togaware.com/

# Shalizi Advanced Data Analysis book
https://www.coursera.org/course/rprog

# Michael Clark (Notre Dame): good tutorials
C:\Research\R\Tutorials\Michael Clark
http://www3.nd.edu/~mclark19/projects.html
http://www3.nd.edu/~mclark19/code.html
https://github.com/mclark--

# Winston Chang? - very good tech insights
http://www.jottr.org/
http://www.jottr.org/?view=magazine

# magrittr examples
http://timelyportfolio.blogspot.com/2014/06/a-whole-new-r-world-with-chains-and.html
http://timelyportfolio.github.io/rCharts_factor_analytics/factors_with_new_R.html
http://martinsbioblogg.wordpress.com/2014/03/27/more-fun-with-and/
http://australianbioinformatics.net/the-pipeline/2014/7/14/r-the-getting-of-wisdom.html#.U8UphPldWYI
https://gist.github.com/anonymous/0c69b019d0b4f6ae5050

# reshape2 package for melting and casting data frames (or arrays)
https://github.com/hadley/reshape
# reshape2 plus ggplot2 tutorials
http://seananderson.ca/2013/10/19/reshape.html
http://martinsbioblogg.wordpress.com/2013/01/27/a-slightly-different-introduction-to-r-part-ii/


### data validation
### tidyr for data scrubbing
http://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html
http://blog.rstudio.org/2014/07/22/introducing-tidyr/
https://github.com/hadley/tidyr

# use 'faithful' data set for examples

# R: the good parts
http://blog.datascienceretreat.com/post/69789735503/r-the-good-parts


# Online Homework Delivery Systems
http://sourceforge.net/projects/openwebwork/
http://www.nsta.org/publications/news/story.aspx?id=51970


### R environment

set R_PROFILE variable

setting up .RProfile file
customizations


.Rprofile file shouldn't include any code that affects the results of programs, as this would make them irreproducible for other users.
.Rprofile file shouldn't load packages, change the options of functions, define functions etc. 
Instead, add an initialization script at the top level of every project file
R code should be self-contained and reproducible 


special functions
.First
.Last


.Rprofile file can include code that changes the appearance of R:

# describing options() params
# set global options
options()
# get global options
getOption()

example:
option_values <- options()  # get all global options
length(option_values)
head(option_values)
tail(option_values)
options("digits")
options(digits=3)

# set wide display for multiple monitors
options(width=160)

getOption("max.print")
options("max.print")
options(max.print=100)

# set default CRAN mirror
options(repos=c(CRAN="http://cran.rstudio.com")))

# set prompt
options(prompt="R", digits=4, show.signif.stars=FALSE)

# customize windows graphics defaults
setHook(packageEvent("grDevices", "onLoad"),
        function(...)
            grDevices::windows.options(width=8, height=6,
                                       xpos=0, pointsize=10,
                                       bitmap.aa.win="cleartype"))


###


# style guide
I follow Hadley Wickham's style guide, with some small exceptions.
I liked your points about using whitespace to enhance readability and shorten length of lines.

I personally dislike the '<-' assignment operator, but I still use it in R, instead of '='.  The reason is that the two assignment operators are not equivalent in R.
The '<-' and '=' operators differ in scope and precedence ('<-' has higher precedence than '=')

The '=' operator is used for named arguments in function calls.

As a rule of thumb, I use '<-' in R scripts, and I use '=' in function calls.

If I had a choice, I would completely eliminate the '<-' assignment operator.


### Control statements

inside if() statements almost always use '||' and '&&'


use this:
my_var <- if (my_clause) A.expression else B.expression

instead of this:
if (my_clause) {
my_var <- A.expression
} else {
my_var <- B.expression
}


foreach
read:
foreach Nesting Loops.pdf


### regular expressions

# string manipulation

# Convert string into variable
http://cran.r-project.org/doc/FAQ/R-FAQ.html#How-can-I-turn-a-string-into-a-variable_003f
http://www.r-bloggers.com/converting-a-string-to-a-variable-name-on-the-fly-and-vice-versa-in-r/
http://stackoverflow.com/questions/6034655/r-how-to-convert-string-to-variable-name
http://stackoverflow.com/questions/9057006/getting-strings-recognized-as-variable-names-in-r



### data types and classes

### data structures

### vectors

rep()


### tips and tricks

### matrices

don't allocate empty numeric matrix using
x <- matrix(nrow=500, ncol=100)
it creates logical values

as soon as you assign a numeric value to any of the cells in 'x', 
the matrix will first have to be coerced to numeric when a new value is assigned.

Instead allocate empty matrix using

x <- matrix(NA_real_, nrow=500, ncol=100)  # real matrix
x <- matrix(NA_integer_, nrow=500, ncol=100)


# don't grow matrices, instead of:
rmat <- NULL
for (i in 1:n)  {
	rmat <- rbind(rmat, long.computation(i,.....))
}

# use:

rmat <- matrix(0.0, n, k)  # allocate
for (i in 1:n)  {
	rmat[i,] <- long.computation(i,.....)
}

# another example:
http://www.bioinformaticszen.com/post/simple-functional-programming-in-r/

married <- c("Yes","Yes","No","No","Yes","Yes","","No","Yes")
# now initialize and grow - will perform poorly because the new vector binary.married is recreated each time to add a new element onto the end.
binary.married <- c()
for (i in 1:length(married)) {
  if(married[i] == "Yes"){
    binary.married <- c(binary.married, 1)
  } else {
    binary.married <- c(binary.married, 0)
  }
}

# use instead:
binary.married <- rep(0, length(married))
for (i in 1:length(married)) {
  if(married[i] == "Yes") binary.married[i] <- 1
}

# rewrite above using apply
binary.married <- sapply(married, function (x) (x=="Yes"))
binary.married <- sapply(married, function (x) switch(x, Yes=1, No=0, NA))

# even better:
character.to.binary <- function(x) {
  switch(x, Yes=1, No=0, NA)
}
binary.married <- sapply(married, character.to.binary)

# Proportion of respondents married
mean(binary.married[binary.married != ""])
mean(binary.married, na.rm=TRUE)


# for large n, better to create transpose, column by column, instead of row by row:
tmat <- matrix(0.0, k, n)
for (i in 1:n)  {
	tmat[, i] <- long.computation(i, .....)
}



# subsetting
x[ind, drop=FALSE]
drop=FALSE

Use
subset(x, ...)
only in interactive, not in function


# R matrixStats package
demonstrate fast Methods that apply to rows and columns of a matrix


### data frames

Working with data frames
http://en.wikibooks.org/wiki/R_Programming/Working_with_data_frames

sort
order()

which()


### operators


comparison operators
'=='
identical()


set operators
%in% binary operator
(6:10) %in% (1:36)
which(c("a", "b", "c", "d", "e", "a", "b", "c", "d", "e") %in% c("d", "e"))

http://stat.ethz.ch/R-manual/R-devel/library/base/html/match.html

get indexes of the specific elements inside a larger vector - we are asking which elements of (1:36 %in% 1:6) are TRUE:
which(1:36 %in% 6:10)

all(1:6 %in% 0:36)
all(1:60 %in% 0:36)

any(1:6 %in% 0:36)
any(1:60 %in% 0:36)
any(50:60 %in% 0:36)

if(length(union(smallset,bigset) > length(bigset)) print('disjunct sets')


# Combinatorial functions

create combinations of n elements, m at a time
combn(x, m, FUN=NULL, simplify=TRUE, ...)
combn(letters[1:4], 2)

create data frame from all combinations of factors or vectors
expand.grid()
x <- seq(0, 10, length.out=100)
y <- seq(-1, 1, length.out=20)
d1 <- expand.grid(x=x, y=y)
d2 <- expand.grid(x=x, y=y, KEEP.OUT.ATTRS=FALSE)



# plyr

# dplyr 0.2
http://blog.rstudio.org/2014/05/21/dplyr-0-2/


### input/output


# Construct the path to a file from components in a platform-independent way
file.path(dir_name, vec_file_names)

give examples of file manipulation
file.create()
file.exists()
file.rename()

R data formats: RData, Rda, Rds etc
http://stackoverflow.com/questions/21370132/r-data-formats-rdata-rda-rds-etc


# simple example to write lines of text to a file

find out more:
?connections

fileConn <- file("output.txt")
writeLines(c("Hello","World"), fileConn)
close(fileConn)
# unlink("ex.data")

file, pipe, fifo, url, gzfile, bzfile, xzfile, unz and socketConnection return a connection object which inherits from class "connection" and has a first more specific class.


Package ‘xlsx’
read.xls from the gdata package
In RStudio go to Workspace/Import Dataset
runs read.csv() for you
recycling rule

captures all output sent to the standard output and returns a character vector where each element correspond to a line of output.
capture.output() 
it does not capture the output sent to the standard error, e.g. cat("Hello\nworld!\n", file=stderr()) and message("Hello\nworld!\n").
it is very slow
captureOutput() function of R.utils

# running scripts

# saving output to file

https://groups.google.com/forum/#!topic/knitr/TCz9vNLlslY

http://comments.gmane.org/gmane.comp.lang.r.knitr/267


### Date and Time

date and time conversion
Posix
UTC TZ
http://www.noamross.net/blog/2014/2/10/using-times-and-dates-in-r---presentation-code.html

# package lubridate
http://www.r-statistics.com/2012/03/do-more-with-dates-and-times-in-r-with-lubridate-1-1-0/


### plotting
functions: plot, line, points

package ggplot
http://www.statmethods.net/advgraphs/ggplot2.html


# create ggpvis example:
download daily return data for a dozen assets: stocks, bonds, REITS
create weighted average portfolio of these assets
create ggpvis application to dynamically plot the portfolio, while adjusting its weights
display portfolio performance statistics on the plot


### data management


explain load() function:
loads data and returns name invisibly


# apply functions
create function to:
in apply loop load data from a file 
scrub it
write to file 
use tryCatch()


###

show option_example.R

ROC curve
Precision Recall Curve (PR Curve)


###
topics to cover:

# regression topics

class lm and sublclasses


# regression sources
James Statistical Learning in R
Rnews_2002-3 Regression Diagnostic.pdf
Faraway Practical Regression and Anova using R.pdf


# regression examples:
http://machinelearningmastery.com/linear-regression-in-r/


# optimization



###


### functions

# view source code of function
http://stackoverflow.com/questions/19226816/how-can-i-view-the-source-code-for-a-function
http://stackoverflow.com/questions/3485228/view-source-code-in-r
http://librestats.com/2014/05/01/searching-an-r-functions-source-code/
https://gist.github.com/wrathematics/11378737

Non-visible functions aren't exported

http://stackoverflow.com/questions/5835312/looking-at-internal-methods

for packages not attached to the search path

explain functions:
UseMethod()
NextMethod()


# examples: just shows UseMethod() call
getAnywhere('rollapply')
A single object matching ‘rollapply’ was found
It was found in the following places
  package:zoo
  namespace:zoo
with value

function (data, ...) 
UseMethod("rollapply")
<environment: namespace:zoo>

# similar to SumDots()
# example for homework or test: rewrite MySum() so that it is recursive, instead of calling sum()
MySum <- function(n.var1=2, n.var2=1, ...) { # define function MySum
# default values can be specified in the argument list
n.var1 + 2*n.var2 + sum(...)
# the function returns the last evaluated statement
} # end MySum


# examples: this shows source code
getAnywhere('rollapply.zoo')
getAnywhere('rollmedian.zoo')


the .* functions:
	.C
	.Call
	.Fortran
	.External
	.Internal
	.Primitive
call functions that are compiled

primitive functions

the .* functions:
.Internal
.Primitive
are used to call functions built into the R interpreter


# function debugging

function edit
edit()

debug()
browser()
stopifnot()

Return values
return()
side-effects
copy-on-modify semantics
modifying a function argument does not change the original value

# function dispatch


getOption()

UseMethod()
When a function calling UseMethod("fun") is applied to an object with class attribute c("first", "second"), the system searches for a function called fun.first and, if it finds it, applies it to the object. 
If no such function is found a function called fun.second is tried. 
If no class name produces a suitable function, the function fun.default is used, if it exists, or an error results.

good example
http://stackoverflow.com/questions/8430178/arguments-and-classes-for-writing-generic-functions-in-r


### function operators

# functions that have functions as arguments
http://adv-r.had.co.nz/Functionals.html


incoroporate rollmedian() example

A function operator is a function that takes one (or more) functions as input and returns a function as output.
function operators are similar to functionals
function operators extract common patterns of anonymous function use


# Functional Programming using Map and Reduce

Map()
Reduce()
Filter()

Map() computes two or more lists (or data frames) in parallel
Map() is a variant of lapply(), where all arguments can vary
Map() is equivalent to mapply with simplify=FALSE


match.fun()
call a function 'func'
call_fun <- function(func, ...) func(...)

# lists of functions
http://adv-r.had.co.nz/Functional-programming.html

lapply(compute_mean, function(f) system.time(f(x)))


### parallel computing 

http://beckmw.wordpress.com/2014/01/21/a-brief-foray-into-parallel-processing-with-r/
http://blog.revolutionanalytics.com/2013/12/tips-on-computing-with-big-data-in-r.html

# foreach package for loops with parallel processing
http://blog.revolutionanalytics.com/2013/08/wonders-of-foreach.html
http://blog.revolutionanalytics.com/2009/05/parallelized-backtesting-with-foreach.html
http://blog.revolutionanalytics.com/2009/07/simple-scalable-parallel-computing-in-r.html
http://blog.revolutionanalytics.com/2009/08/parallel-programming-with-foreach-and-snow.html

http://www.exegetic.biz/blog/2013/11/iterators-in-r/

code from:
http://adv-r.had.co.nz/Functionals.html
library(parallel)
parallel::mclapply()
parallel::mcMap()
unlist(mclapply(1:10, sqrt, mc.cores=4))


# create parallel bootstrap example as in:
http://adv-r.had.co.nz/Functionals.html



### Infix functions
prefix operators

# Defining new binary operators
"%!%" <- function(X, y) { ... }

The function could then be used as X %!% y.



###
FRE6871_Lecture_1

calculate percentage returns for stock index
create and plot histogram of returns
calculate and plot the probability kernel density
apply Shapiro-Wilk test

class

storage mode
typeof
type coercion

dim, length

cbind() and rbind()

Subsetting

http://adv-r.had.co.nz/Subsetting.html

head, tail
first, last


###
FRE6871_Lecture_2

Internal R Help and Documentation



create frame with plots of different probability distributions: uniform, normal, Chi2, t, F
probability distributions
distributions of returns

random
create frame with random number generation
create frame with simple applications of: dnorm, pnorm, qnorm, rnorm
set.seed()
random numbers
random vectors

create frame with moments estimator
sample mean, variance, skewness, kurtosis


Some packages include lots of datasets.
The datasets package
Title Data sets for econometrics
Garch Daily Observations on Exchange Rates of the US Dollar Against Other Currencies
The AER package includes replication datasets for some important textbooks in econometrics.
The EcDat package includes replication archive for the Journal of Applied Econometrics, the Journal of Business and Economic Statistics, etc

Yule 1899 data



### packages

# base packages
base packages are part of R distribution, and are in the source tree in individual package directories under /src/library/
Examples include: base, compiler, stats, and utils.
compiled code are in a 


# loading packages

# installing packages from github
install.packages("devtools")
devtools::install_github("hadley/tidyr")

CRAN Views

Estimate moments using package moments


# package download and unzip source in cwd
untar(download.packages(pkgs="xts",
                        destdir=".",
                        type="source")[,2])



### environments

new.env()
enclosing parent environment
An environment is very similar to a list, with three important exceptions:
Environments have parents. 
There is only one exception: the empty environment does not have a parent.

The parent environment of a function is the environment in which a function was defined

the top-level environment is the global environment (workspace) or the namespace of a package

first-class environments can be manipulated from within the language

parent frame: the latter (returned by parent.frame) refers to the environment of the caller of a function.
parent frame is the calling environment

standard "options" list

setting and getting defaults

# view current namespaces
loadedNamespaces()


### functions

Components of a function
function calls
parameter passing rules: use example built-in function to explain

default argument values
Partial name matching
function lazy evaluation
for example paste() save() or seq()
typing function name without parentheses producs code for that function

introduce functions
Biostatistics 140.776
write a simple function
http://adv-r.had.co.nz/Functions.html

Function for calculating moments

# Create functions
http://adv-r.had.co.nz/Functions.html
http://ww2.coastal.edu/kingw/statistics/R-tutorials/functions.html


### scope

create separate slide for Lexical Scoping
Environments are the data structures that power scoping
Lexical vs. Dynamic Scoping
Explain Lexical Scoping on example
If an object is not found in an environment, then R will look at its parent (and so on). 

When a function is evaluated, $R$ looks in the function search path for any variables in scope,
\vskip1ex
The evaluation environment is first, then the functions enclosing environment, which will be the global environment for functions defined in the workspace.
\vskip1ex
When R looks up the value for a symbol the frame is examined and if a matching symbol is found its value will be returned. If not, the enclosing environment is then accessed and the process repeated. 
\vskip1ex

global variables can be referenced inside a function.


###
FRE6871_Lecture_3

# super-assignment operator
permanent assignments are intended within a function, then either the
"superassignment" operator, <<- or the function assign() can be used.
global assignment operator: <<-
assignment operator for enclosing environment <<-


# Control statements

http://en.wikibooks.org/wiki/R_Programming/Control_Structures

Venables:
R has available a conditional construction of the form
> if (expr_1) expr_2 else expr_3
where expr 1 must evaluate to a single logical value

vectorized version of the if/else construct, the ifelse function
	ifelse(condition, a, b)
returns a vector of the length of its longest argument,
with elements a[i] if condition[i] is true, otherwise b[i].


# for loops
for (n.inp in v.inp)

# while loops for simulation
barrier option example


# Vectorization in R
http://www.noamross.net/blog/2014/4/16/1-in-r--why.html
http://stackoverflow.com/questions/15917233/elegant-way-to-vectorize-seq?lq=1
http://stackoverflow.com/questions/13544594/create-a-vector-function-from-a-scalar-function?rq=1

create assignment to vectorize function using ifelse
http://stackoverflow.com/questions/13544594/create-a-vector-function-from-a-scalar-function?rq=1


example of vectorizing grid search
vec.objective.alphaModel <- Vectorize(v.objective.alphaModel)
widths <- 65:75
windows <- 15:25
thresholds <- 0.1*(13:45)
profile.alpha <- outer(widths, windows, vec.objective.alphaModel)
profile.alpha <- outer(windows, thresholds, vec.objective.alphaModel)
max(profile.alpha)
rownames(profile.alpha) <- widths
colnames(profile.alpha) <- windows
rownames(profile.alpha) <- windows
colnames(profile.alpha) <- thresholds
coordinates.matrix(profile.alpha, min)
coordinates.matrix(profile.alpha, max)


# code speed and profiling

command execution time
system.time()

Rprof()
unix.time()
gc()


### Functions

# Recursive functions
# R supports recursive functions. The function below computes Fibonacci numbers recursively.

# Functions in R are "first class objects"
which means that they can be treated much like any other R object. 
Functions can be passed as arguments to other functions
Functions can be nested, so that you can define a function inside of another function
Functions can return functions as their result

Functions as Objects - Functions returning functions
Functions that return another function as its value
functions defined inside other functions

# anonymous functions
(function(x) x + 3)(10)
apply() with anonymous functions
anonymous functions as arguments to functions

formulas as arguments to functions


Explain on examples why defining functions inside other functions is useful in analysis


# Function factories
Closures are useful for making function factories, and are one way to manage mutable state in R.

function environments disappear once the function finishes executing, but when a function returns a function, then its environment is attached to the new function. 

# mutable states
mutable states can be modified using the "superassignment" operator "<<-" or the function assign()

the function assign() assigns a value to a name in an environment
the default is to assign in the enclosing environment


mutable states
http://homepage.stat.uiowa.edu/~luke/R/references.html
mutatr: Mutable objects for R
# Avoid mutable state!!!
http://programmers.stackexchange.com/questions/148108/why-is-global-state-so-evil


### Condition Handling and Recovery
Exception Handling in R
# keywords:
exception handling trycatch
R debugging
error handling

function error and warning handling
function exception handling
try()
tryCatch()


Conditions: Errors and Warnings
Warnings are much more common than Errors
Errors occur when: matching arguments, if/else statement not logical or a numeric, recycle rule
Error options
There are a number of options variables that can be used to control how R handles errors and warnings. The are listed in the table below.
‘warn’
Controls the printing of warnings.
‘warning.expression’
Sets an expression that is to be evaluated when a warning occurs. The normal printing of warnings is suppressed if this option is set.
‘error’
Installs an expression that will be evaluated when an error occurs. The normal printing of error messages and warning messages precedes the evaluation of the expression.
warnings can be created using the function warning()
takes a single argument that is a character string
the option "warn" 
The behaviour of a call to warning depends on the value of 

# check the class of try object to determine if call was successful
tmp_instr <- try(getInstrument(this_symbol, silent=FALSE))
if (inherits(tmp_instr, "try-error") || !is.instrument(tmp_instr)) 

# using "recover" function for error handling
options(error=recover)
http://www.burns-stat.com/the-options-mechanism-in-r/
https://stat.ethz.ch/R-manual/R-devel/library/utils/html/recover.html

# try an Expression Allowing Error Recovery
http://stat.ethz.ch/R-manual/R-devel/library/base/html/try.html


### functionals

functionals extract common patterns of loop use

# explain this syntax for removing zero length list elements
my_list <- list('a', 2, integer(0))
my_list[lapply(my_list, length)>0]


# apply functions

create exercise to convert for loop to apply call

with(PlantGrowth, tapply(weight, group, sem))

from:
http://adv-r.had.co.nz/Functions.html
x <- list(1:3, 4:9, 10:12)
sapply(x, "[", 2)
#> [1]  2  5 11

# equivalent to
sapply(x, function(x) x[2])
#> [1]  2  5 11

http://adv-r.had.co.nz/Functionals.html

sapply() is a thin wrapper around lapply() that transforms a list into a vector in the final step

sapply() silently returns a list if the function returns results of different types or lengths
vapply() will throw an error

sapply() guesses the output type
vapply() takes an additional argument of output type
use sapply() interactively 
use vapply() inside other functions

good examples
http://stackoverflow.com/questions/15733518/efficient-way-to-loop-in-r?rq=1

Wickham Split Apply Combine for Data Analysis

Higher-order functions - apply functions
takes one or more functions as an input - outputs a function
The map function is an example of a higher-order function.
The apply function is the most basic of R's map functions. 
apply takes as arguments an array, a vector of the dimension to map along and a function. 

split and apply example:
http://www.analyticsvidhya.com/blog/2014/05/tricky-interview-questions/
a <- c(1,1,1,1,2,2,2,2,2)
b <- c(10,12,15,12,NA,30,42,38,40)
s <- split(b,a)
lapply(s,mean,na.rm=TRUE)


###
FRE6871_Lecture_4

# Using apply, sapply, lapply in R
http://petewerner.blogspot.com/2012/12/using-apply-sapply-lapply-in-r.html

### time series
Aggregation of time series data over window: mean, median, hi, low, close
package zoo
package xts
package forecast
http://www.statmethods.net/advstats/timeseries.html


### Data scrubbing

NaN represents an undefined value ("not a number")
producing NaN
managing NaN
NA or NaN
is.na()
is.nan()

Remove NAs option
na.rm=TRUE


###
FRE6871_Lecture_5

# Data Munging

ts.data <- read.csv("data.csv", stringsAsFactors=FALSE)

# package zoo
time()
difftime()
coredata()
lag()
diff()
window()
rollapply()
rollmean()
?rollapply examples


join operations
merge()
merge(blah, blahh, join='inner')

cbind merge() two zoo series with different indices
detect missing dates
Apply Various strategies for dealing with NAs: 
remove - na.omit()
linear interpolation, 
last observation carried forward - na.locf()

# create series of dates
daily, monthly, quarterly, yearly series
Class: "yearqtr", "yearmon"
as.yearmon
yearmon
yearqtr

create function to create EOM, EOQ, EOY dates

remove duplicate dates
http://stackoverflow.com/questions/8865257/r-language-remove-duplicate-rows-from-xts-object

aggregate

get calendar using RQuantLib
calculate business days

allign calendars


# duplicate data

unique(mydat) # keep unique rows
library(cwhmisc)
remove.dup.rows(mydat) # similar to unique()
table(duplicated(mydat)) # table duplicated lines
mydat$dups <- duplicated(mydat) # add a logical variable for duplicates


# classes, generic functions and object orientation

class(x)
class(x) <- value
unclass(x)
inherits(x, what, which=FALSE)

method dispatch

Primitive functions

repeat Lexical scoping

Name masking

Functions vs. variables

binding function calls


###
FRE6871_Lecture_6

create frame explaining hypothesis testing

Shapiro-Wilk test
Jarque Bera test

ACF
PACF



Type I and Type II errors, 

# Homework Assignment
# zoo object helper function
create a function that performs the following:
input is zoo object 
output is summary statistics


###
FRE6871_Lecture_7

Time Series models

slides:
introduce differencing: acf and pacf before and after differencing
example of time series with non-zero autocorrelation
### Autocorrelation tests
### Ljung-Box to test for autocorrelations different from zero

introduce AR model
introduce MA model
introduce ARIMA model

Identification of Autoregressive Processes

Is this true?
For purely deterministic processes, the non-zero PACF coefficients are equal to the correlation coefficients of the \emph{AR}(n) process,

Fitting Time Series models
show that DAX can't fit neither AR nor MA
fit DAX into ARIMA
fit diff DAX into ARIMA

fit using ar()
auto.arima()
arima()
Arima()
spec.ar(ts.retsPair,log='no')
spec.pgram(ts.retsPair,log='no')

fitted(arima.pc1), order.by=index(ts.pca))


### regression

Formulas object
Relationships among variables can be specified. 
The ~ operator is basic to formulas in R.
y ~ x means "y is explained by x".
f.obj <- y ~ x
class(f)

R2 is a statistic that will give some information about the goodness of fit of a model.
Adjusted R2 is a modification of R2 that adjusts for the number of explanatory terms in a model.

correlation and regression
http://ww2.coastal.edu/kingw/statistics/R-tutorials/simplelinear.html

test residuals

### Durbin-Watson test for first order autocorrelations of regression residuals
Durbin-Watson test for first order autocorrelations of regression residuals

Regression Diagnostic: Rnews_2002-3



###################################
###	EXTRA TOPICS		###
###################################



### Fitting Market Returns

Fit EuStockMarkets DAX returns into t-dist by using Method of Moments:
matching sample moments with distribution moments
# Fitting Market Returns - page is NA
http://blog.revolutionanalytics.com/2014/02/quantitative-finance-applications-in-r-4-using-the-generalized-lambda-distribution-to-simulate-market-returns.html
http://blog.revolutionanalytics.com/2014/10/quantitative-finance-applications-in-r-9.html
http://blog.revolutionanalytics.com/2014/10/gldex-part-2.html

Goodness of fit using the chi-squared statistic
http://en.wikipedia.org/wiki/Goodness_of_fit
use chisq.test()
http://ww2.coastal.edu/kingw/statistics/R-tutorials/prob.html
t.test( )
Wilcoxin test
wilcox.test()
http://ww2.coastal.edu/kingw/statistics/R-tutorials/singlesample.html
http://ww2.coastal.edu/kingw/statistics/R-tutorials/independent-t.html

illustrate multinomial distribution goodness of fit test
http://www.r-tutor.com/elementary-statistics/goodness-fit/multinomial-goodness-fit
http://ww2.coastal.edu/kingw/statistics/R-tutorials/independent-t.html

illustrate Hypothesis Testing using Jarque–Bera test

apply Shapiro-Wilk test

fit EuStockMarkets DAX returns into normal-dist - find p-value
fit EuStockMarkets DAX returns into t-dist - find p-value

create frame with max likelihood
illustrate max likelihood with simulated data

# Optimization

Example from Biostatistics functions
C:\Research\R\Tutorials\Johns Hopkins Biostatistics
Application: Optimization
use example from functions.pdf from Johns Hopkins Biostatistics
for Plotting the Likelihood
No need to carry around long argument lists

create frame with Fisher information


# fit normal distribution
library(MASS)  # library MASS has fitdistr
fitdistr(ts.rets, "normal")  # fit normal distribution
# fit t-distribution into histogram of returns
fitdistr(ts.rets, "t")  # fit t-distribution


# Customizing Startup

http://www.statmethods.net/interface/customizing.html


# Homework Assignment
# create a function that performs the following:
input is a vector with possible NA values
output named vector of length two, with first value being total number of elements of input vector 
with possible NA values
if input is not a vector, then function returns a warning message
output named vector of length two, with first value being total number of elements of input vector 
counts NAs as data values and doesn't tell you

# Homework Assignment
# create a function that performs the following:
reads a matrix from a file
restores rownames (if needed)
you can call functions read.csv() or scan()


# Options Settings
https://stat.ethz.ch/R-manual/R-devel/library/base/html/options.html

### parsing arguments and variables

# Look for an Argument in the Call
hasArg()

# get value of variable from its string
get()
Return the Value of a Named Object
get(make.names("agg_price_window"))
get(paste("agg", "price", "window", sep="_"))
get("agg_price_window")


Replacement function replace() - not sure it's important
http://stackoverflow.com/questions/11563154/what-are-replacement-functions-in-r
http://stackoverflow.com/questions/11811027/replace-function-examples



####

